# REZVO — Cursor Project Context
# Place this file at the root of your repo as .cursorrules
# ============================================================

## WHAT IS REZVO

Rezvo is a UK multi-vertical booking platform ("Your High Street, Booked") targeting independent restaurants, barbers, salons, and spas. Think OpenTable meets Fresha — a single platform where consumers discover and book local businesses, and business owners manage their operations.

The business model:
- FREE tier: Directory listing (pre-populated from Google Places API)
- PRO tier (£20/month): Online booking, table/chair management, CRM, analytics
- PREMIUM tier: Promoted search listings, Google Review Booster, priority support
- Revenue streams: Subscriptions, promoted listings (pay-per-click in search results), Stripe payment processing fees, Dojo POS referrals (£500 per switch)

## TECH STACK

### Backend
- **Framework:** FastAPI (Python 3.11+)
- **Database:** MongoDB (using Motor async driver)
- **Auth:** JWT tokens (python-jose), bcrypt password hashing
- **Payments:** Stripe Connect (each business connects their own Stripe account, deposits flow directly to them)
- **File uploads:** Cloudflare R2 or AWS S3
- **Email:** Resend or SendGrid
- **SMS:** Twilio
- **External APIs:** Google Places API (New), Google Maps JavaScript API, Google Geocoding API

### Frontend
- **Framework:** React 18+ with Vite
- **Styling:** Tailwind CSS 3
- **State:** React Context (TierContext for business type/tier logic)
- **Routing:** React Router v6
- **Icons:** Inline SVGs (no icon libraries — keeps bundle small)
- **Fonts:** Loaded via Google Fonts link tag, NOT npm packages

### Infrastructure
- **Hosting:** DigitalOcean Droplet (London datacenter)
- **Reverse proxy:** Nginx
- **Process manager:** systemd (backend) + Nginx serves built React
- **SSL:** Let's Encrypt via Certbot
- **Domain:** rezvo.co.uk
- **CDN:** Cloudflare (DNS + caching + DDoS protection)

## BRAND IDENTITY — FOLLOW THIS EXACTLY

### Colors (British Racing Green palette)
```
--forest:    #1B4332    (Primary — buttons, headers, active states)
--f90:       #2D6A4F    (Hover states, secondary actions)
--f70:       #40916C    (Links, accents)
--f50:       #52B788    (Success states, positive indicators)
--f30:       #74C69D    (Tags, badges, light accents)
--sage:      #6B7C6E    (Muted text, secondary UI)
--sage-lt:   #95A397    (Borders, disabled states)
--cream:     #FAFAF7    (Page backgrounds)
--off:       #F7F8F6    (Card backgrounds, alternating rows)
--white:     #FFFFFF    (Cards, inputs, modals)
--border:    #E5E8E3    (Borders, dividers)
--border-lt: #EDEEE9    (Subtle dividers)
--text:      #1a1a1a    (Primary text)
--t2:        #4a4a4a    (Secondary text)
--t3:        #777777    (Tertiary text, labels)
--t4:        #aaaaaa    (Placeholder text, timestamps)
--gold:      #D4A017    (Star ratings, premium badges)
--red:       #C8362E    (Errors, cancellations, no-shows)
```

### Typography
- **Headings:** `'Bricolage Grotesque', system-ui, sans-serif` — weights 600, 700, 800
- **Body:** `'Figtree', system-ui, sans-serif` — weights 400, 500, 600

NOTE: Some existing frontend code still uses `'Plus Jakarta Sans'` or `'DM Sans'` — these need migrating to Bricolage Grotesque + Figtree.

### Design Principles
- Clean, minimal UI with generous whitespace
- No emoji in UI elements (only in user-facing content like filter pills)
- Rounded corners: 8px for inputs, 12-16px for cards, 100px for pills/tags
- Shadows: subtle only — `box-shadow: 0 4px 20px rgba(0,0,0,.04)`
- Transitions: 0.12s for hover states, 0.2s for page transitions
- No icon libraries — use inline SVG (Lucide icon paths are fine, just inline them)

## ARCHITECTURE

### Tier System (Critical — drives everything)
Every business gets a `tier` that determines available features:

| Tier | Business Types | Key Features |
|------|---------------|-------------|
| `solo` | Solo barber, freelance stylist | Calendar, basic CRM, profile |
| `team` | Multi-chair salon, barber shop | Staff management, chair assignments |
| `venue` | Restaurant, spa, multi-room | Floor plan, table management, reservations |

The tier is set during onboarding and stored on the business document. The frontend TierContext reads this and conditionally renders sidebar items, pages, and features.

### Four Interfaces
1. **Consumer web directory** — Public pages (rezvo.co.uk/restaurants/london/...) 
2. **Business dashboard** — Authenticated owner/staff portal (dashboard.rezvo.co.uk or rezvo.co.uk/dashboard)
3. **Tablet floor plan** — Touch-optimized drag-and-drop table management (iPad/tablet)
4. **Consumer mobile app** — React Native (future phase, not built yet)

### URL Structure (SEO-critical)
```
/restaurants/                                    → Category hub
/restaurants/london/                             → City hub  
/restaurants/london/shoreditch/                  → Area hub
/restaurants/london/shoreditch/italian-restaurants → Cuisine filter page
/restaurants/london/shoreditch/romantic           → Occasion filter page
/restaurants/london/shoreditch/the-barking-dog    → Individual listing
/barbers/manchester/                             → Barber category in Manchester
/salons/brighton/                                → Salon category in Brighton
```

Every filter combination = unique URL = indexable page for SEO. The database has 7,140+ pre-generated SEO page URLs.

### Database Schema (MongoDB collections)

**locations** — UK towns and cities
```
{ name, slug, county, region, lat, lng, population }
```

**businesses** — Every business (claimed or unclaimed)
```
{
  google_place_id, location_id, category (restaurant|barber|salon|spa),
  name, slug, address, phone, website, google_maps_url,
  rating, review_count, price_level, primary_type, all_types[],
  lat, lng, editorial_summary, opening_hours{}, photo_refs[],
  serves_breakfast, serves_brunch, serves_lunch, serves_dinner,
  serves_vegetarian, serves_beer, serves_wine,
  dine_in, takeout, delivery, reservable,
  // Rezvo-specific:
  claimed (bool), owner_id, rezvo_tier (free|pro|premium),
  promoted (bool), notify_count,
  // If claimed — additional fields:
  stripe_account_id, booking_settings{}, floor_plan{},
  staff[], menu[], custom_photos[]
}
```

**users** — Both diners and business owners
```
{
  email, password_hash, role (diner|owner|staff|admin),
  name, phone, avatar,
  // Diner-specific:
  saved_businesses[], booking_history[], review_history[],
  // Owner-specific:
  business_ids[], stripe_connected
}
```

**reservations** — All bookings across all business types
```
{
  business_id, user_id, 
  date, time, duration_minutes, party_size,
  table_id (venues), staff_id (salons/barbers), service_id,
  status (confirmed|seated|completed|no_show|cancelled),
  deposit_amount, deposit_status,
  notes, special_requests
}
```

**reviews** — User reviews on businesses
```
{
  business_id, user_id, reservation_id,
  rating (1-5), body, photos[],
  categories {food, service, atmosphere, value},
  helpful_count, created_at
}
```

### Backend Module Structure
The backend has 14 route modules with 127+ endpoints:
```
routes/
  auth.py           — Register, login, JWT, password reset
  users.py          — Profile management, preferences
  businesses.py     — CRUD, claiming, onboarding
  bookings.py       — Reservations, availability, waitlist
  directory.py      — Public search, filters, Google Places import
  tables.py         — Floor plan, table management (venue tier)
  staff.py          — Staff profiles, schedules (team/venue tier)
  services.py       — Menu items / service offerings
  reviews.py        — Submit, moderate, respond to reviews
  analytics.py      — Dashboard metrics, reports
  reputation.py     — Google Review Booster, sentiment tracking
  growth.py         — Lead pipeline, notification collection
  payments.py       — Stripe Connect, deposits, billing
  settings.py       — Business settings, hours, notifications
```

### Frontend Structure
```
src/
  components/
    layout/
      AppLayout.jsx         — Sidebar + top bar (authenticated)
      PublicLayout.jsx       — Header + footer (public directory)
    shared/                  — Reusable UI components
  contexts/
    AuthContext.jsx           — User auth state
    TierContext.jsx           — Business tier + feature gating
  pages/
    public/                  — Directory, listing, search results
    dashboard/               — Authenticated business pages
    onboarding/              — Multi-step business setup
  hooks/                     — Custom React hooks
  utils/                     — API client, helpers, constants
  styles/                    — Tailwind config, global styles
```

## WHAT'S BUILT vs WHAT NEEDS BUILDING

### ✅ Built
- Backend: 127 endpoints across 14 modules (routes defined, core logic implemented)
- Frontend: Dashboard shell, TierContext, dynamic sidebar, 10+ pages
- Frontend: Responsive design (mobile/tablet/desktop)
- Brand: Design tokens, Tailwind config (partially applied)
- Booking calendar: v3 with timeline/Gantt view, colour-coded status blocks
- Web directory: 4 HTML prototypes (homepage, listing, search results, onboarding)
- UK database seeder: 140 locations, 7,140 SEO URLs, Google Places pipeline
- VPS deployment guide

### ❌ Needs Building (Priority Order)
1. **Auth system** — JWT login/register for diners + owners + staff, middleware
2. **Deploy to VPS** — Get the existing code live on DigitalOcean London
3. **Google API integration** — Create account, run population script, wire maps
4. **Convert HTML prototypes → React** — Directory, search results, listing page
5. **Floor plan editor** — Drag-and-drop table management (venue tier)
6. **Real booking flow** — Consumer selects slot → confirms → payment → email
7. **Stripe Connect** — Onboarding flow, deposit collection, payout management
8. **Review system** — Post-visit email trigger → rating → optional Google redirect
9. **Photo uploads** — Business photos + customer review photos → CDN
10. **Notification system** — Email/SMS for confirmations, reminders, waitlist alerts
11. **CRM** — Customer profiles, visit history, preferences, notes
12. **Analytics** — Real dashboard data (bookings, revenue, reviews, no-show rate)
13. **Landing/marketing site** — Homepage explaining Rezvo to potential business owners
14. **Mobile consumer app** — React Native (later phase)

## CODING CONVENTIONS

### Python (Backend)
- Async everywhere — all route handlers are `async def`
- Type hints on all function signatures
- Pydantic models for request/response validation
- Environment variables via `python-decouple` or `os.environ`
- Error responses use consistent format: `{"detail": "message"}`
- MongoDB operations use Motor async driver
- All dates in ISO 8601 UTC

### React (Frontend)  
- Functional components only (no class components)
- Hooks for state management (useState, useEffect, useContext)
- Tailwind utility classes — NO separate CSS files per component
- Use `const` for component definitions: `const MyComponent = () => { ... }`
- Props destructured in function signature
- API calls go through a central `api.js` utility
- Loading states and error handling on every data fetch
- Accessible: aria labels, semantic HTML, keyboard navigation

### Tailwind Config
The Tailwind config should extend with Rezvo brand tokens:
```js
module.exports = {
  theme: {
    extend: {
      colors: {
        forest: { DEFAULT: '#1B4332', 90: '#2D6A4F', 70: '#40916C', 50: '#52B788', 30: '#74C69D' },
        sage: { DEFAULT: '#6B7C6E', light: '#95A397' },
        cream: '#FAFAF7',
        gold: '#D4A017',
      },
      fontFamily: {
        heading: ['Bricolage Grotesque', 'system-ui', 'sans-serif'],
        body: ['Figtree', 'system-ui', 'sans-serif'],
      },
      borderRadius: {
        card: '16px',
        input: '8px',
        pill: '100px',
      }
    }
  }
}
```

### Git
- Branch naming: `feature/floor-plan-editor`, `fix/auth-token-refresh`
- Commit messages: imperative tense (`Add floor plan drag-drop`, not `Added...`)
- Main branch: `main`
- Always pull before pushing

## IMPORTANT CONTEXT

- The existing codebase was originally built for salons and has been adapted for multi-vertical use. Some salon-specific terminology may still exist in code and needs updating.
- The HTML prototype files (directory, listing, search results) represent the target UI — use them as visual reference when building React components.
- The booking calendar JSX artifacts represent the target for the dashboard booking view.
- Google Places data is the foundation — businesses exist in the directory even if unclaimed. When an owner "claims" their listing, they get access to the dashboard.
- The growth engine works by tracking "notify me" clicks from diners on unclaimed businesses. When threshold is reached, system sends warm lead email to the business owner showing proof of demand.

## REPO STRUCTURE
```
rezvo/
├── backend/
│   ├── server.py              — FastAPI app entry point
│   ├── config.py              — Environment config
│   ├── database.py            — MongoDB connection
│   ├── models/                — Pydantic models
│   ├── routes/                — 14 route modules
│   ├── services/              — Business logic layer
│   ├── middleware/             — Auth, CORS, rate limiting
│   └── requirements.txt
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   ├── contexts/
│   │   ├── pages/
│   │   ├── hooks/
│   │   ├── utils/
│   │   └── App.jsx
│   ├── public/
│   ├── index.html
│   ├── tailwind.config.js
│   ├── vite.config.js
│   └── package.json
├── scripts/
│   └── rezvo_seed_uk.py       — UK database seeder + Google Places populator
├── docs/
│   ├── REZVO-BUILD-SPEC.md
│   ├── REZVO-HANDOVER.md
│   └── rezvo-google-api-setup.md
├── prototypes/                — HTML reference prototypes
│   ├── rezvo-directory-v3.html
│   ├── rezvo-listing-page.html
│   ├── rezvo-search-results.html
│   └── rezvo-list-your-business.html
├── .cursorrules               — THIS FILE
├── .env.example
├── docker-compose.yml
├── nginx.conf
└── README.md
```

## SERVER DETAILS
- **Provider:** DigitalOcean
- **Datacenter:** London (LON1)
- **Domain:** rezvo.co.uk
- **SSL:** Let's Encrypt (auto-renew via Certbot)
