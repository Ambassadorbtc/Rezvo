=== MANUAL FIX: HTTPS 503 + ANTHROPIC API KEY ===

Your local SSH commands are hanging. Run these commands DIRECTLY on the server.

=== STEP 1: SSH INTO SERVER ===
ssh root@146.190.111.28

=== STEP 2: DIAGNOSE HTTPS 503 ===

A. Check SSL certificates:
   sudo certbot certificates

B. Find nginx config:
   ls -la /etc/nginx/sites-enabled/

C. View nginx config (replace 'rezvo' with actual filename):
   sudo cat /etc/nginx/sites-enabled/rezvo

D. Check backend service:
   sudo systemctl status rezvo-backend

E. Check if backend is listening:
   ss -tlnp | grep 8000

F. Check nginx errors:
   sudo tail -30 /var/log/nginx/error.log

=== STEP 3: FIX HTTPS (choose based on diagnosis) ===

OPTION A: If NO SSL certificate exists:
   sudo certbot --nginx -d rezvo.co.uk -d www.rezvo.co.uk
   # Follow prompts, then test: curl -I https://rezvo.co.uk

OPTION B: If certificate exists but nginx config is wrong:
   sudo nano /etc/nginx/sites-enabled/rezvo
   
   # Make sure you have a server block like this:
   server {
       listen 443 ssl http2;
       server_name rezvo.co.uk www.rezvo.co.uk;
       
       ssl_certificate /etc/letsencrypt/live/rezvo.co.uk/fullchain.pem;
       ssl_certificate_key /etc/letsencrypt/live/rezvo.co.uk/privkey.pem;
       
       root /opt/rezvo/frontend/dist;
       index index.html;
       
       location / {
           try_files $uri $uri/ /index.html;
       }
       
       location /api/ {
           proxy_pass http://127.0.0.1:8000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
   }
   
   # Save (Ctrl+O, Enter, Ctrl+X), then:
   sudo nginx -t
   sudo systemctl reload nginx

OPTION C: If backend is not running:
   sudo systemctl restart rezvo-backend
   sudo systemctl status rezvo-backend
   sudo journalctl -u rezvo-backend -n 50

=== STEP 4: ADD ANTHROPIC API KEY ===

A. Edit backend .env file:
   sudo nano /opt/rezvo/backend/.env

B. Add this line (replace with your actual key):
   ANTHROPIC_API_KEY=sk-ant-YOUR-ACTUAL-KEY-HERE

C. Save and exit (Ctrl+O, Enter, Ctrl+X)

D. Restart backend:
   sudo systemctl restart rezvo-backend

E. Verify it's running:
   sudo systemctl status rezvo-backend
   sudo journalctl -u rezvo-backend -n 20

=== STEP 5: VERIFY EVERYTHING WORKS ===

A. Test HTTPS:
   curl -I https://rezvo.co.uk
   # Should return: HTTP/2 200

B. Test API:
   curl -I https://rezvo.co.uk/api/docs
   # Should return: HTTP/2 200

C. Open in browser:
   https://rezvo.co.uk (should show SSL padlock)
   https://rezvo.co.uk/api/docs (should show Swagger UI)

D. Test voice search:
   - Go to homepage
   - Click the AI voice search button
   - Say something like "Italian restaurant in Shoreditch"
   - Should process and show results (not error)

=== COMMON ISSUES ===

Issue: "502 Bad Gateway" instead of 503
Fix: Backend is not running. Check: sudo systemctl status rezvo-backend

Issue: "Connection refused" on port 8000
Fix: Backend crashed. Check logs: sudo journalctl -u rezvo-backend -n 50

Issue: SSL certificate not found
Fix: Run certbot: sudo certbot --nginx -d rezvo.co.uk -d www.rezvo.co.uk

Issue: nginx test fails
Fix: Check syntax errors in config, fix them, test again

=== QUICK REFERENCE ===

Backend service name: rezvo-backend
Backend port: 8000
Frontend path: /opt/rezvo/frontend/dist
Backend .env: /opt/rezvo/backend/.env
Nginx config: /etc/nginx/sites-enabled/rezvo (or default)
SSL certs: /etc/letsencrypt/live/rezvo.co.uk/

=== REPORT BACK ===

After running these commands, report:
1. What did "sudo certbot certificates" show?
2. What's in the nginx config (the listen 443 block)?
3. Is the backend running? (systemctl status)
4. Did HTTPS start working?
5. Did the API key get added successfully?
